import{a as r,g as u,s as l,G as d,b as g,H as m}from"./header-u1vxfMaN.js";import{j as p}from"./justValidate-ywqcVI2V.js";import{g as w,d as z,c as f,a as W,s as b}from"./index.esm2017-WC45BDwc.js";import{B as c}from"./buttonEventHandler-4aVT9HNW.js";class D{app;auth;constructor(){this.app=r,this.auth=u(),this.authorizationWithEmail=this.authorizationWithEmail.bind(this),this.authorizationWithGoogle=this.authorizationWithGoogle.bind(this)}authorizationWithEmail(){const a=document.querySelector("#authorizationMail"),t=a.value,o=document.querySelector("#authorizationPassword"),e=o.value;l(this.auth,t,e).then(i=>{const s=i.user;window.location.href="account.html",a.value="",o.value="",console.log("User signed in:",s)}).catch(i=>{const s=i.code,h=i.message;alert("Почта или пароль введены неверно"),console.error("Login failed:",s,h)})}authorizationWithGoogle(){const a=new d;g(this.auth,a).then(t=>{const o=t.user,e={email:o.email||"",name:o.displayName||"",photo:o.photoURL||"",orders:[]};this.addUserToFirebase(o.uid,e).then(()=>{window.location.href="account.html",console.log("Authorization with Google successful. UID:",o.uid)}).catch(i=>{console.error("Error adding user to Firebase: ",i)})}).catch(t=>{const o=t.code,e=t.message;alert("Не удалось войти с помощью Google"),console.error("Login failed:",o,e)})}async addUserToFirebase(a,t){const o=w(r),e=z(f(o,"users"),a);if((await W(e)).exists()){console.log("User document already exists. Skipping addition.");return}await b(e,t).then(()=>{console.log("Document written with UID as documentId:",a)}).catch(s=>{console.error("Error adding document: ",s)})}}document.addEventListener("DOMContentLoaded",()=>{p();const n=new D;new c(".authorization__btn-registration",n,"authorizationWithEmail"),new c(".authorization__form-btn-google",n,"authorizationWithGoogle"),new m});
